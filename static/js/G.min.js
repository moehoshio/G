let makePrismLineNum=()=>{let e=document.getElementsByTagName("pre");if(e.length>0)for(let t of e)t.className=t.className+" line-numbers";document.querySelectorAll('code[class="c++"]')?.forEach(e=>{e.className="lang-cpp"}),"undefined"!=typeof Prism&&Prism.highlightAll(!0,null)},preLazy=(e,t,o,n="")=>{for(let l of e)l.setAttribute(o,l.getAttribute(t)),l.setAttribute(t,n)},lazyBanner=(e,t)=>{let o=e.target.getAttribute("origin");new Promise((e,t)=>{let n=new Image;n.onload=function(){e(o.slice(22,-2))},n.src=o.slice(22,-2)}).then(n=>{e.target.setAttribute("style",o+"visibility: visible;animation: banner-show 1s;"),t.unobserve(e.target)})},lazyPic=(e,t)=>{new Promise((t,o)=>{let n=new Image;n.onload=function(){t(n.src)},n.src=e.target.getAttribute("origin")}).then(o=>{e.target.setAttribute("src",o),addClass(e.target,"lazyload-done"),t.unobserve(e.target)}).catch(e=>{console.log("图片載入失败",e)})},lazyload=(e,t)=>{if(e.length>0){const o=new IntersectionObserver(e=>{for(let n of e)n.isIntersecting&&t(n,o)});for(let t of e)o.observe(t)}},collapseController=e=>{"true"==e.parentNode.getAttribute("data-collapsed")?(expandSection(e.parentNode.children[1]),e.parentNode.setAttribute("data-collapsed","false")):(e.parentNode.setAttribute("data-collapsed","true"),e.parentNode.children[1].setAttribute("style","height: auto;"),collapseSection(e.parentNode.children[1]))},sponsorToggle=()=>{let e=document.querySelector("#post-sponsor");"true"==e.dataset.collapsed?(expandSection(e),e.dataset.collapsed="false"):(e.dataset.collapsed="true",e.setAttribute("style","height: auto;"),collapseSection(e))},lightbox=e=>{let t=document.createElement("div");t.classList.add("lightbox-wrap"),t.innerHTML='<img alt="" style="max-width: 80%;max-height: 80%;" src="'+e.src+'">',t.setAttribute("onclick","closeLightbox(this)"),document.body.appendChild(t)},closeLightbox=e=>{e.setAttribute("style","animation: opacity-out .2s;opacity: 0;"),setTimeout(()=>{document.body.removeChild(e)},200)},makeGallery=()=>{let e=document.getElementsByClassName("photos");for(let t of e)for(let e of t.children){let t=new Image;t.src=e.children[0].children[0].getAttribute("src"),t.onload=function(){let o=t.width,n=t.width;e.setAttribute("style","width: "+50*o/n+"px;flex-grow: "+50*o/n),e.children[0].setAttribute("style","padding-top: "+n/o*100+"%")}}},darkModeToggle=()=>{document.querySelector('link[title="dark"]').disabled=!document.querySelector('link[title="dark"]').disabled},autoDarkMode=()=>{const[e,t]=window.G_CONFIG.nightSpan.split("-"),o=window.G_CONFIG.nightMode,n={3:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,2:(new Date).getHours()>=parseInt(e)||(new Date).getHours()<parseInt(t),1:(new Date).getHours()>=parseInt(e)||(new Date).getHours()<parseInt(t)||window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches};"0"!==o&&Object.keys(n).includes(o)&&(document.querySelector('link[title="dark"]').disabled=!n[o])},toolbarInit=()=>{document.querySelector("#gototop").onclick=function(){window.scroll({top:0,left:0,behavior:"smooth"})},document.querySelector("#darkmode").onclick=darkModeToggle,document.querySelector("#sidebar-btn").onclick=toggleSidebar},toggleOwO=()=>{let e=document.querySelector("#OwO-container");e.classList.contains("OwO-in")||e.classList.contains("OwO-out")?(e.classList.toggle("OwO-in"),e.classList.toggle("OwO-out")):e.classList.add("OwO-in")},closeOwO=()=>{(document.getElementById("OwO-container").classList.contains("OwO-in")||!document.getElementById("OwO-container").classList.contains("OwO-out")&&1===document.getElementById("OwO-container").classList.length)&&toggleOwO()},toggleToc=()=>{document.getElementById("toc").classList.toggle("toc-show"),document.getElementById("main").classList.toggle("toc-show-main")},toggleSidebar=()=>{document.getElementById("sliderbar").classList.toggle("move-left"),document.getElementById("sliderbar").classList.toggle("move-right");document.getElementById("sliderbar-cover").classList.toggle("sliderbar-cover__show")},slideOwO=e=>{document.querySelector("#"+e).scrollIntoView({behavior:"smooth"})},ajaxComment=()=>{let e="",t=document.querySelector("#comment_form"),o=()=>{document.querySelectorAll(".comment-reply a").forEach(t=>{t.onclick=function(){return e=t.parentNode.parentNode.parentNode.parentNode.id,TypechoComment.reply(e,parseInt(e.slice(8)))}}),document.querySelectorAll(".cancel-comment-reply a").forEach(t=>{t.onclick=()=>(e="",TypechoComment.cancelReply())})};function n(t){t&&(document.getElementById("comments-textarea").value="",e="",showToast("成功送出")),o()}o(),t.onsubmit=function(){return commentData=objSerialize(t),closeOwO(),Ajax.post(t.getAttribute("action"),commentData).then(t=>{let o=document.createElement("div");if(o.innerHTML=t,o.getElementsByTagName("title").length>0&&o.getElementsByTagName("title")[0].innerText===document.title)n(!0),TypechoComment.cancelReply(),document.querySelector("#comments").removeChild(document.querySelector(".comment-list")),document.querySelector("#comments").appendChild(o.querySelector(".comment-list")),e="";else{n(!1);let e=o.querySelector(".container")?o.querySelector(".container").innerText:o.childNodes[0].childNodes[0].childNodes[0].innerText;showToast("留言失敗，"+e)}}).catch(e=>{let t=document.createElement("div");t.innerHTML=e;let o=t.querySelector(".container")?t.querySelector(".container").innerText:t.childNodes[0].childNodes[0].childNodes[0].innerText;showToast("留言失敗，"+o.replaceAll("<br>",""))}),!1}};Smilies={dom:function(e){return document.querySelector(e)},grin:function(e){e=" "+e+" ",myField=this.dom("#comments-textarea"),document.selection?(myField.focus(),sel=document.selection.createRange(),sel.text=e,myField.focus()):this.insertTag(e)},insertTag:function(e){myField=Smilies.dom("#comments-textarea"),myField.selectionStart||"0"===myField.selectionStart?(startPos=myField.selectionStart,endPos=myField.selectionEnd,cursorPos=startPos,myField.value=myField.value.substring(0,startPos)+e+myField.value.substring(endPos,myField.value.length),cursorPos+=e.length,myField.focus(),myField.selectionStart=cursorPos,myField.selectionEnd=cursorPos):(myField.value+=e,myField.focus())}};let TocInit=()=>{let e=document.querySelectorAll(".PAP-content h1, .PAP-content h2, .PAP-content h3");e.length>0&&(e.forEach(e=>{e.onclick=()=>{toggleToc()},e.id=e.innerHTML}),tocbot.init({tocSelector:"#toc-content",contentSelector:".PAP-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,headingsOffset:40,scrollSmoothOffset:-40}),window.G_CONFIG.autoTOC&&document.body.clientWidth>830&&toggleToc())},pageInit=()=>{document.querySelectorAll(".PAP-content img").forEach(e=>{if(!e.classList.contains("bq")){e.dataset.src=e.getAttribute("origin"),e.classList.add("spotlight");let t=document.createElement("span");t.innerText=e.getAttribute("title"),t.classList.add("imageinfo"),e.after(t)}}),makeGallery(),TocInit(),null!==document.getElementById("comment_form")&&ajaxComment(),makePrismLineNum(),window.G_CONFIG.katex&&document.querySelector(".PAP-content")&&renderMathInElement(document.querySelector(".PAP-content"),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!0}),custom_callback()},doLazyload=()=>{let e=document.getElementsByClassName("article-banner"),t=document.querySelectorAll("img:not(#header-background):not(#profile-avatar)");preLazy(e,"style","origin"),preLazy(t,"src","origin",window.G_CONFIG.imgUrl+"loading.gif"),lazyload(e,function(e,t){lazyBanner(e,t)}),lazyload(t,function(e,t){lazyPic(e,t)})},sendLike=()=>{let e=document.querySelector("#agree-btn");e.style.disabled=!0,Ajax.post(e.dataset.url,"agree="+e.dataset.cid).then(t=>{if(/\d/.test(t)){let o=e.childNodes[3];parseInt(t)==parseInt(o.innerHTML)?showToast("已經贊過咯～"):showToast("點贊成功"),o.innerHTML=t,o.parentNode.childNodes[1].innerHTML="😍"}else showToast("出了點小問題")})},DYLM=throttle(e=>{let t=document.querySelector("#DoYouLikeMe p span");Ajax.post(e,"DYLM=add").then(e=>{"success"===e?(t.innerText=parseInt(t.innerText)+1,showToast("傾心您❤️～")):showToast(e)})},1e3);function ExSearchCall(e){e&&e.length&&(document.querySelector(".ins-close").click(),pjax.loadUrl(e[0].dataset.url))}document.addEventListener("pjax:send",()=>{if("undefined"!=typeof aplayers)for(let e=0;e<aplayers.length;e++)try{aplayers[e].destroy()}catch(e){console.log(e)}tocbot.destroy(),document.getElementById("spotlight")&&Spotlight.close(),document.getElementById("main").classList.contains("toc-show-main")&&toggleToc(),window.scroll({top:0,left:0,behavior:"smooth"});let e=document.querySelector("#container")||document.querySelector(".PAP")||document.querySelector("#lyrics");if(e){e.setAttribute("style","animation: opacity-out var(--theme-animation-out-duration, 1s) ease;opacity: 0;");let t=1e3*parseFloat(getComputedStyle(e).getPropertyValue("--theme-animation-out-duration"));setTimeout(function(){e.style.opacity="0"},t)}}),document.addEventListener("pjax:complete",()=>{"undefined"!=typeof Prism&&Prism.highlightAll(!0,null),"function"==typeof loadMeting&&loadMeting(),doLazyload(),pageInit()}),window.ready(function(){doLazyload(),console.log("G.js ready"),window.pjax=new Pjax({elements:"a:not([target='_blank']):not([no-pjax])",selectors:["#main","title"],timeout:1e4,cacheBust:!1,scrollRestoration:!0}),autoDarkMode(),toolbarInit(),pageInit()}),window.onbeforeunload=function(){};